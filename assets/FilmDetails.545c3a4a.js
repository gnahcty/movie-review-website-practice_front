import{Q as T}from"./QRating.1294e232.js";import{Q as P}from"./QToolbarTitle.11d51743.js";import{Q as H}from"./QToolbar.e1137fe2.js";import{aH as K,u as E,m as W,r as C,W as j,c as Q,w as O,o as M,j as b,k as D,t as i,d as m,x as u,Q as y,s as F,a5 as Y,F as z,ak as f,aL as G,aM as J,ag as I,v as S,aj as X,ad as U,q as Z,aK as ee,ah as te}from"./index.64fd29e4.js";import{Q as se,F as oe}from"./FilmReview.68f5b3de.js";import{Q as le}from"./QList.9c60ac6a.js";import{C as ie}from"./ClosePopup.ff97eb30.js";import{u as ae}from"./use-quasar.777f94d2.js";import{u as re}from"./checkLogin.72adf871.js";import"./use-form.d519241c.js";import"./format.a33550d6.js";import"./QImg.41799b64.js";import"./QItemLabel.5663fafa.js";import"./QItem.68e34164.js";import"./use-dark.50c66a58.js";import"./QMenu.a610fb29.js";import"./position-engine.7624e5c6.js";import"./use-timeout.2dd8620f.js";import"./scroll.6216abb4.js";import"./QCardSection.b36efdbc.js";import"./QBtnDropdown.abcde0c2.js";import"./uid.42677368.js";import"./QTooltip.81eea7d2.js";import"./use-fullscreen.82cdb5cd.js";import"./QCard.7f9f7a2c.js";const ne=g=>(G("data-v-3b7625d1"),g=g(),J(),g),de={class:"flex-center column q-gutter-y-sm",style:{"min-width":"320px"}},ce=["src"],me={class:"flex flex-center q-gutter-x-sm"},ue={id:"reviewDialog",class:"border10 column q-gutter-xl bg-white"},pe=ne(()=>i("div",{class:"text-h3 lilita q-mt-none"}," Your Review",-1)),ve={class:"row flex-center q-gutter-md"},fe={__name:"RatingCard",props:{film:{type:Object,default:()=>({id:"",title:"",poster:"",overview:"",director:""})},cmtDeleted:{type:Boolean,default:()=>!1}},emits:["newCmt"],setup(g,{emit:q}){const c=g,{checkLogin:h,loginTryCatch:n}=re(),d=E(),x=W(),L=ae(),w=C(!1),v=C(""),o=j({like:!1,ratings:0,watched:!1,comments:""}),$=Q(()=>v.value===""),k=Q(()=>o.comments!==""),V=Q(()=>d.watchList.some(a=>a.id===c.film.id.toString())),s=()=>{w.value=!0},t=async()=>{o.watched=!o.watched,await f.post("/reviews/",{filmID:c.film.id,watched:o.watched,ratings:o.ratings}),_()},l=async()=>{await f.post("/reviews/",{filmID:c.film.id,like:!o.like}),_()},p=async()=>{const{data:a}=await f.post("/reviews/",{filmID:c.film.id,comments:v.value});w.value=!1,v.value="",_(),q("newCmt",a.result),L.notify({type:"success",message:"Review added successfully"})},R=async()=>{const a={filmID:c.film.id,title:c.film.title,poster:c.film.poster};await f.post("/users/watchlist",a),A()},A=async()=>{const{data:a}=await f.get("users/profile");d.watchList=a.result.watchList},_=async()=>{var e,r,B,N;const{data:a}=await f.get("/reviews/user/"+x.params.id);o.like=((e=a.result)==null?void 0:e.like)||!1,o.ratings=((r=a.result)==null?void 0:r.ratings)||0,o.watched=((B=a.result)==null?void 0:B.watched)||!1,o.comments=((N=a.result)==null?void 0:N.comments)||""};return O(()=>o.ratings,async(a,e)=>{if(a!==e)try{await f.post("/reviews/",{filmID:x.params.id,ratings:a}),_()}catch(r){console.error("Error sending ratings:",r)}}),M(async()=>{d.isLogin&&_()}),(a,e)=>(b(),D(z,null,[i("div",de,[i("img",{class:"col-7 rounded border10",src:"http://image.tmdb.org/t/p/w300/"+c.film.poster,style:{"border-radius":"32px"}},null,8,ce),m(T,{modelValue:o.ratings,"onUpdate:modelValue":e[0]||(e[0]=r=>o.ratings=r),max:"5",size:"50px",color:"black",icon:"eva-star-outline","icon-selected":"eva-star","icon-half":"star_half",readonly:!u(d).isLogin},null,8,["modelValue","readonly"]),i("div",me,[m(y,{flat:"",round:"",icon:"fa-regular fa-eye",size:"xl",color:o.watched?"green":"grey",disable:!u(d).isLogin,onClick:e[1]||(e[1]=r=>u(n)(t))},null,8,["color","disable"]),m(y,{flat:"",round:"",color:o.like?"red":"grey",icon:"favorite",onClick:e[2]||(e[2]=r=>u(n)(l)),disable:!u(d).isLogin,size:"xl"},null,8,["color","disable"]),m(y,{flat:"",round:"",color:V.value?"blue":"grey",icon:"more_time",onClick:e[3]||(e[3]=r=>u(n)(R)),disable:!u(d).isLogin,size:"xl"},null,8,["color","disable"])]),m(y,{color:"yellow-8","text-color":"white",label:k.value&&!c.cmtDeleted?"reviewed":"review",disable:k.value&&!c.cmtDeleted,style:{width:"200px",height:"73px","font-size":"xx-large"},class:"rounded15 lilita q-py-none",onClick:e[4]||(e[4]=r=>u(h)(s))},null,8,["label","disable"])]),m(le,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=r=>w.value=r),"full-width":""},{default:F(()=>[i("div",ue,[pe,m(se,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=r=>v.value=r),placeholder:"Write something...",class:"text-left col-8 border10 rounded15",readonly:!u(d).isLogin},null,8,["modelValue","readonly"]),i("div",ve,[m(y,{flat:"",label:"submit",class:"border5 rounded15 lilita",onClick:e[6]||(e[6]=r=>u(n)(p)),disable:$.value},null,8,["disable"]),Y(m(y,{flat:"",label:"cancel",class:"border5 rounded15 lilita",onClick:e[7]||(e[7]=r=>v.value="")},null,512),[[ie]])])])]),_:1},8,["modelValue"])],64))}};var ge=K(fe,[["__scopeId","data-v-3b7625d1"]]);const we={class:"row justify-center"},ye={class:"col-12 col-xl-10 row justify-around"},he={class:"col-12 col-md-3 flex flex-center",style:{height:"90vh","min-width":"320px"}},xe={class:"col-12 col-md-8 col-lg-9 flex flex-center",style:{height:"90vh","overflow-y":"scroll"}},_e={class:"bg-grey-2 q-px-lg-xl q-px-md-none q-px-md fit"},be={class:"lilita titles",style:{"margin-bottom":"-15px"}},ke={class:"text-h5"},De=i("span",{class:"q-mr-md underline"},"2022",-1),Ce={class:"underline"},qe={class:"title3 text-bold"},Le={class:"q-pt-xl"},$e={class:"q-gutter-y-lg q-mt-md"},et={__name:"FilmDetails",setup(g){const q=E(),c=C(0),h=W(),n=j({id:"",title:"",poster:"",overview:"",director:""}),d=j([]),x=C(!1),L=async()=>{try{const{data:s}=await U.get("/films/"+h.params.id);n.id=s.results.id,n.title=s.results.title,n.poster=s.results.poster_path,n.overview=s.results.overview,n.director=await w(n.id,"Director")}catch(s){console.log(s)}},w=async(s,t)=>{try{const{data:l}=await U.get("/films/"+s+"/crew"),p=l.results.crew.filter(R=>R.job===t);return v(p)}catch(l){console.log(l)}},v=s=>{const t=[];for(const l of s)t.push(l.name);return t.join()},o=async()=>{const{data:s}=await U.get("/reviews/"+h.params.id);d.splice(0,d.length,...s.results);let t=0,l=0;for(const p of d)p.ratings>0&&(t+=p.ratings,l++);c.value=t/l||0},$=async()=>{const{data:s}=await f.get(`reviews/${h.params.id}/friend`);console.log(s)},k=s=>{const t=d.findIndex(l=>l._id===s.result._id);t!==-1&&(d[t].comments=s.result.comments)},V=()=>{o(),x.value=!0};return M(async()=>{await L(),o(),q.isLogin&&$()}),(s,t)=>(b(),D("div",we,[i("div",ye,[i("div",he,[m(ge,{film:n,cmtDeleted:x.value,onNewCmt:t[0]||(t[0]=l=>o())},null,8,["film","cmtDeleted"])]),i("div",xe,[i("div",_e,[i("div",null,[i("div",be,I(n.title),1),i("div",ke,[De,i("span",null,[S("Directed by "),i("span",Ce,I(n.director),1)])]),m(T,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=l=>c.value=l),size:"50px",icon:"eva-star-outline","icon-selected":"eva-star",class:"q-my-md",color:"black",readonly:""},null,8,["modelValue"]),i("div",qe,I(n.overview),1)]),i("div",Le,[m(H,{class:"q-pl-none",style:{"border-bottom":"5px solid #000"}},{default:F(()=>[m(P,{class:"text-h3 lilita"},{default:F(()=>[S(" Comments ")]),_:1})]),_:1}),i("div",$e,[(b(!0),D(z,null,X(d,l=>(b(),D(z,{key:l.id},[l.comments!==""?(b(),Z(oe,ee({key:0},l,{onCmtUpdated:t[2]||(t[2]=p=>k(p)),onCmtDeleted:t[3]||(t[3]=p=>V())}),null,16)):te("",!0)],64))),128))])])])])])]))}};export{et as default};
