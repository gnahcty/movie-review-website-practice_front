import{Q as E}from"./QRating.5796855c.js";import{Q as O}from"./QToolbarTitle.f2da1378.js";import{Q as P}from"./QToolbar.c8c652de.js";import{aJ as G,m as W,n as A,r as $,Z as F,c as I,w as J,o as M,j as k,k as L,v as i,d,y as m,Q as x,t as N,A as Y,F as S,am as g,aN as Z,aO as H,u as K,ai as U,x as T,al as X,af as j,s as ee,aM as te,aj as se}from"./index.41ebcf44.js";import{Q as oe,F as le}from"./FilmReview.4e95916a.js";import{Q as ie}from"./QList.6b0a790d.js";import{C as ae}from"./ClosePopup.51e90440.js";import{u as re}from"./use-quasar.66b5834f.js";import{u as ne}from"./checkLogin.3872f0d9.js";import"./use-form.a2dd561e.js";import"./format.a33550d6.js";import"./QImg.8353c75d.js";import"./QItemLabel.28cb7de0.js";import"./QItem.7fd5a40a.js";import"./use-dark.bb245855.js";import"./QMenu.aa415c4d.js";import"./position-engine.06a14c74.js";import"./use-timeout.d53a31c9.js";import"./scroll.a7a5ba3b.js";import"./QCardSection.2f9e2c7c.js";import"./QBtnDropdown.e63feebd.js";import"./uid.42677368.js";import"./QTooltip.413bc218.js";import"./use-fullscreen.a1c1ded3.js";import"./QCard.0e8d47b1.js";const de=w=>(Z("data-v-2addb566"),w=w(),H(),w),ce={class:"flex-center column q-gutter-y-sm",style:{"min-width":"320px"}},me=["src"],ue={class:"flex flex-center q-gutter-x-sm"},pe={id:"reviewDialog",class:"border10 column q-gutter-xl bg-white"},ve=de(()=>i("div",{class:"text-h3 lilita q-mt-none"}," Your Review",-1)),fe={class:"row flex-center q-gutter-md"},ge={__name:"RatingCard",props:{film:{type:Object,default:()=>({id:"",title:"",poster:"",overview:"",director:""})},cmtDeleted:{type:Boolean,default:()=>!1}},emits:["newCmt"],setup(w,{emit:q}){const c=w,{checkLogin:h,loginTryCatch:v}=ne(),o=W(),u=A(),D=re(),y=$(!1),f=$(""),a=F({like:!1,ratings:0,watched:!1,comments:""}),_=I(()=>f.value===""),C=I(()=>a.comments!==""),V=I(()=>o.watchList.some(r=>r.id===c.film.id.toString())),R=()=>{y.value=!0},s=async()=>{a.watched=!a.watched,await g.post("/reviews/",{filmID:c.film.id,watched:a.watched,ratings:a.ratings}),b()},t=async()=>{await g.post("/reviews/",{filmID:c.film.id,like:!a.like}),b()},l=async()=>{const{data:r}=await g.post("/reviews/",{filmID:c.film.id,comments:f.value});y.value=!1,f.value="",b(),q("newCmt",r.result),D.notify({type:"success",message:"Review added successfully"})},p=async()=>{const r={filmID:c.film.id,title:c.film.title,poster:c.film.poster};await g.post("/users/watchlist",r),Q()},Q=async()=>{const{data:r}=await g.get("users/profile");o.watchList=r.result.watchList},b=async()=>{var e,n,z,B;const{data:r}=await g.get("/reviews/user/"+u.params.id);a.like=((e=r.result)==null?void 0:e.like)||!1,a.ratings=((n=r.result)==null?void 0:n.ratings)||0,a.watched=((z=r.result)==null?void 0:z.watched)||!1,a.comments=((B=r.result)==null?void 0:B.comments)||""};return J(()=>a.ratings,async(r,e)=>{if(r!==e)try{await g.post("/reviews/",{filmID:u.params.id,ratings:r}),b()}catch(n){console.error("Error sending ratings:",n)}}),M(async()=>{o.isLogin&&b()}),(r,e)=>(k(),L(S,null,[i("div",ce,[i("img",{class:"col-7 rounded border10",src:"https://image.tmdb.org/t/p/w300/"+c.film.poster,style:{"border-radius":"32px"}},null,8,me),d(E,{modelValue:a.ratings,"onUpdate:modelValue":e[0]||(e[0]=n=>a.ratings=n),max:"5",size:"50px",color:"black",icon:"eva-star-outline","icon-selected":"eva-star","icon-half":"star_half",readonly:!m(o).isLogin},null,8,["modelValue","readonly"]),i("div",ue,[d(x,{flat:"",round:"",icon:"fa-regular fa-eye",size:"xl",color:a.watched?"green":"grey",disable:!m(o).isLogin,onClick:e[1]||(e[1]=n=>m(v)(s))},null,8,["color","disable"]),d(x,{flat:"",round:"",color:a.like?"red":"grey",icon:"favorite",onClick:e[2]||(e[2]=n=>m(v)(t)),disable:!m(o).isLogin,size:"xl"},null,8,["color","disable"]),d(x,{flat:"",round:"",color:V.value?"blue":"grey",icon:"more_time",onClick:e[3]||(e[3]=n=>m(v)(p)),disable:!m(o).isLogin,size:"xl"},null,8,["color","disable"])]),d(x,{color:"yellow-8","text-color":"white",label:C.value&&!c.cmtDeleted?"reviewed":"review",disable:C.value&&!c.cmtDeleted,style:{width:"200px",height:"73px","font-size":"xx-large"},class:"rounded15 lilita q-py-none",onClick:e[4]||(e[4]=n=>m(h)(R))},null,8,["label","disable"])]),d(ie,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=n=>y.value=n),"full-width":""},{default:N(()=>[i("div",pe,[ve,d(oe,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=n=>f.value=n),placeholder:"Write something...",class:"text-left col-8 border10 rounded15",readonly:!m(o).isLogin},null,8,["modelValue","readonly"]),i("div",fe,[d(x,{flat:"",label:"submit",class:"border5 rounded15 lilita",onClick:e[6]||(e[6]=n=>m(v)(l)),disable:_.value},null,8,["disable"]),Y(d(x,{flat:"",label:"cancel",class:"border5 rounded15 lilita",onClick:e[7]||(e[7]=n=>f.value="")},null,512),[[ae]])])])]),_:1},8,["modelValue"])],64))}};var we=G(ge,[["__scopeId","data-v-2addb566"]]);const ye={class:"row justify-center"},xe={class:"col-12 col-xl-10 row justify-around"},he={class:"col-12 col-md-3 flex flex-center",style:{height:"90vh","min-width":"320px"}},_e={class:"col-12 col-md-8 col-lg-9 flex flex-center",style:{height:"90vh","overflow-y":"scroll"}},be={class:"bg-grey-2 q-px-lg-xl q-px-md-none q-px-md fit"},ke={class:"lilita titles",style:{"margin-bottom":"-15px"}},De={class:"text-h5"},Ce=i("span",{class:"q-mr-md underline"},"2022",-1),Le={class:"underline"},$e={class:"title3 text-bold"},qe={class:"q-pt-xl"},Ve={class:"q-gutter-y-lg q-mt-md"},tt={__name:"FilmDetails",setup(w){const q=K(),c=W(),h=$(0),v=A(),o=F({id:"",title:"",poster:"",overview:"",director:""}),u=F([]),D=$(!1),y=async()=>{try{const{data:s}=await j.get("/films/"+v.params.id);o.id=s.results.id,o.title=s.results.title,o.poster=s.results.poster_path,o.overview=s.results.overview,o.director=await f(o.id,"Director")}catch(s){console.log(s)}},f=async(s,t)=>{try{const{data:l}=await j.get("/films/"+s+"/crew"),p=l.results.crew.filter(Q=>Q.job===t);return a(p)}catch(l){console.log(l)}},a=s=>{const t=[];for(const l of s)t.push(l.name);return t.join()},_=async()=>{const{data:s}=await j.get("/reviews/"+v.params.id);u.splice(0,u.length,...s.results);let t=0,l=0;for(const p of u)p.ratings>0&&(t+=p.ratings,l++);h.value=t/l||0},C=async()=>{const{data:s}=await g.get(`reviews/${v.params.id}/friend`);console.log(s)},V=s=>{const t=u.findIndex(l=>l._id===s.result._id);t!==-1&&(u[t].comments=s.result.comments)},R=()=>{_(),D.value=!0};return M(async()=>{await y(),await _(),c.isLogin&&C(),q.isLoading=!1}),(s,t)=>(k(),L("div",ye,[i("div",xe,[i("div",he,[d(we,{film:o,cmtDeleted:D.value,onNewCmt:t[0]||(t[0]=l=>_())},null,8,["film","cmtDeleted"])]),i("div",_e,[i("div",be,[i("div",null,[i("div",ke,U(o.title),1),i("div",De,[Ce,i("span",null,[T("Directed by "),i("span",Le,U(o.director),1)])]),d(E,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),size:"50px",icon:"eva-star-outline","icon-selected":"eva-star",class:"q-my-md",color:"black",readonly:""},null,8,["modelValue"]),i("div",$e,U(o.overview),1)]),i("div",qe,[d(P,{class:"q-pl-none",style:{"border-bottom":"5px solid #000"}},{default:N(()=>[d(O,{class:"text-h3 lilita"},{default:N(()=>[T(" Comments ")]),_:1})]),_:1}),i("div",Ve,[(k(!0),L(S,null,X(u,l=>(k(),L(S,{key:l.id},[l.comments!==""?(k(),ee(le,te({key:0},l,{onCmtUpdated:t[2]||(t[2]=p=>V(p)),onCmtDeleted:t[3]||(t[3]=p=>R())}),null,16)):se("",!0)],64))),128))])])])])])]))}};export{tt as default};
