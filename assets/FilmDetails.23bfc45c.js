import{Q as T}from"./QRating.1cb461bd.js";import{Q as O}from"./QToolbarTitle.721f6979.js";import{Q as P}from"./QToolbar.5624d75c.js";import{_ as G,m as W,n as A,r as $,a0 as F,c as I,w as Y,o as M,j as D,k as L,v as i,d,y as m,Q as x,t as S,B as H,F as j,ap as g,D as J,E as K,u as X,al as U,x as N,ao as Z,ai as B,s as ee,aO as te,am as se}from"./index.8d2c1b60.js";import{Q as oe,F as le}from"./FilmReview.28979e5c.js";import{Q as ie}from"./QList.5489a7d4.js";import{C as ae}from"./ClosePopup.435c189b.js";import{u as re}from"./use-quasar.ba5b2673.js";import{u as ne}from"./checkLogin.c70288cd.js";import"./use-form.6494c8b6.js";import"./format.a33550d6.js";import"./QImg.74e7b2de.js";import"./QItemLabel.86396600.js";import"./QItem.ada3ccb9.js";import"./use-dark.971e675a.js";import"./QMenu.e4224a56.js";import"./position-engine.e758a05e.js";import"./use-timeout.2a840c59.js";import"./scroll.8f0bebbd.js";import"./QCardSection.3b59a311.js";import"./QBtnDropdown.5d2197c1.js";import"./uid.42677368.js";import"./QTooltip.47c35e20.js";import"./use-fullscreen.2e6cd3d0.js";import"./QCard.ec06eee3.js";const de=w=>(J("data-v-2addb566"),w=w(),K(),w),ce={class:"flex-center column q-gutter-y-sm",style:{"min-width":"320px"}},me=["src"],ue={class:"flex flex-center q-gutter-x-sm"},pe={id:"reviewDialog",class:"border10 column q-gutter-xl bg-white"},ve=de(()=>i("div",{class:"text-h3 lilita q-mt-none"}," Your Review",-1)),fe={class:"row flex-center q-gutter-md"},ge={__name:"RatingCard",props:{film:{type:Object,default:()=>({id:"",title:"",poster:"",overview:"",director:""})},cmtDeleted:{type:Boolean,default:()=>!1}},emits:["newCmt"],setup(w,{emit:q}){const c=w,{checkLogin:_,loginTryCatch:v}=ne(),o=W(),u=A(),k=re(),y=$(!1),f=$(""),a=F({like:!1,ratings:0,watched:!1,comments:""}),h=I(()=>f.value===""),C=I(()=>a.comments!==""),V=I(()=>o.watchList.some(r=>r.id===c.film.id.toString())),R=()=>{y.value=!0},s=async()=>{a.watched=!a.watched,await g.post("/reviews/",{filmID:c.film.id,watched:a.watched,ratings:a.ratings}),b()},t=async()=>{await g.post("/reviews/",{filmID:c.film.id,like:!a.like}),b()},l=async()=>{const{data:r}=await g.post("/reviews/",{filmID:c.film.id,comments:f.value});y.value=!1,f.value="",b(),q("newCmt",r.result),k.notify({type:"success",message:"Review added successfully"})},p=async()=>{const r={filmID:c.film.id,title:c.film.title,poster:c.film.poster};await g.post("/users/watchlist",r),Q()},Q=async()=>{const{data:r}=await g.get("users/profile");o.watchList=r.result.watchList},b=async()=>{var e,n,z,E;const{data:r}=await g.get("/reviews/user/"+u.params.id);a.like=((e=r.result)==null?void 0:e.like)||!1,a.ratings=((n=r.result)==null?void 0:n.ratings)||0,a.watched=((z=r.result)==null?void 0:z.watched)||!1,a.comments=((E=r.result)==null?void 0:E.comments)||""};return Y(()=>a.ratings,async(r,e)=>{if(r!==e)try{await g.post("/reviews/",{filmID:u.params.id,ratings:r}),b()}catch(n){console.error("Error sending ratings:",n)}}),M(async()=>{o.isLogin&&b()}),(r,e)=>(D(),L(j,null,[i("div",ce,[i("img",{class:"col-7 rounded border10",src:"https://image.tmdb.org/t/p/w300/"+c.film.poster,style:{"border-radius":"32px"}},null,8,me),d(T,{modelValue:a.ratings,"onUpdate:modelValue":e[0]||(e[0]=n=>a.ratings=n),max:"5",size:"50px",color:"black",icon:"eva-star-outline","icon-selected":"eva-star","icon-half":"star_half",readonly:!m(o).isLogin},null,8,["modelValue","readonly"]),i("div",ue,[d(x,{flat:"",round:"",icon:"fa-regular fa-eye",size:"xl",color:a.watched?"green":"grey",disable:!m(o).isLogin,onClick:e[1]||(e[1]=n=>m(v)(s))},null,8,["color","disable"]),d(x,{flat:"",round:"",color:a.like?"red":"grey",icon:"favorite",onClick:e[2]||(e[2]=n=>m(v)(t)),disable:!m(o).isLogin,size:"xl"},null,8,["color","disable"]),d(x,{flat:"",round:"",color:V.value?"blue":"grey",icon:"more_time",onClick:e[3]||(e[3]=n=>m(v)(p)),disable:!m(o).isLogin,size:"xl"},null,8,["color","disable"])]),d(x,{color:"yellow-8","text-color":"white",label:C.value&&!c.cmtDeleted?"reviewed":"review",disable:C.value&&!c.cmtDeleted,style:{width:"200px",height:"73px","font-size":"xx-large"},class:"rounded15 lilita q-py-none",onClick:e[4]||(e[4]=n=>m(_)(R))},null,8,["label","disable"])]),d(ie,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=n=>y.value=n),"full-width":""},{default:S(()=>[i("div",pe,[ve,d(oe,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=n=>f.value=n),placeholder:"Write something...",class:"text-left col-8 border10 rounded15",readonly:!m(o).isLogin},null,8,["modelValue","readonly"]),i("div",fe,[d(x,{flat:"",label:"submit",class:"border5 rounded15 lilita",onClick:e[6]||(e[6]=n=>m(v)(l)),disable:h.value},null,8,["disable"]),H(d(x,{flat:"",label:"cancel",class:"border5 rounded15 lilita",onClick:e[7]||(e[7]=n=>f.value="")},null,512),[[ae]])])])]),_:1},8,["modelValue"])],64))}};var we=G(ge,[["__scopeId","data-v-2addb566"]]);const ye={class:"row justify-center"},xe={class:"col-12 col-xl-10 row justify-around"},_e={class:"col-12 col-md-3 flex flex-center",style:{height:"90vh","min-width":"320px"}},he={class:"col-12 col-md-8 col-lg-9 flex flex-center",style:{height:"90vh","overflow-y":"scroll"}},be={class:"bg-grey-2 q-px-lg-xl q-px-md-none q-px-md fit"},De={class:"lilita titles",style:{"margin-bottom":"-15px"}},ke={class:"text-h5"},Ce=i("span",{class:"q-mr-md underline"},"2022",-1),Le={class:"underline"},$e={class:"title3 text-bold"},qe={class:"q-pt-xl"},Ve={class:"q-gutter-y-lg q-mt-md"},tt={__name:"FilmDetails",setup(w){const q=X(),c=W(),_=$(0),v=A(),o=F({id:"",title:"",poster:"",overview:"",director:""}),u=F([]),k=$(!1),y=async()=>{try{const{data:s}=await B.get("/films/"+v.params.id);o.id=s.results.id,o.title=s.results.title,o.poster=s.results.poster_path,o.overview=s.results.overview,o.director=await f(o.id,"Director")}catch(s){console.log(s)}},f=async(s,t)=>{try{const{data:l}=await B.get("/films/"+s+"/crew"),p=l.results.crew.filter(Q=>Q.job===t);return a(p)}catch(l){console.log(l)}},a=s=>{const t=[];for(const l of s)t.push(l.name);return t.join()},h=async()=>{const{data:s}=await B.get("/reviews/"+v.params.id);u.splice(0,u.length,...s.results);let t=0,l=0;for(const p of u)p.ratings>0&&(t+=p.ratings,l++);_.value=t/l||0},C=async()=>{const{data:s}=await g.get(`reviews/${v.params.id}/friend`);console.log(s)},V=s=>{const t=u.findIndex(l=>l._id===s.result._id);t!==-1&&(u[t].comments=s.result.comments)},R=()=>{h(),k.value=!0};return M(async()=>{await y(),await h(),c.isLogin&&C(),q.isLoading=!1}),(s,t)=>(D(),L("div",ye,[i("div",xe,[i("div",_e,[d(we,{film:o,cmtDeleted:k.value,onNewCmt:t[0]||(t[0]=l=>h())},null,8,["film","cmtDeleted"])]),i("div",he,[i("div",be,[i("div",null,[i("div",De,U(o.title),1),i("div",ke,[Ce,i("span",null,[N("Directed by "),i("span",Le,U(o.director),1)])]),d(T,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=l=>_.value=l),size:"50px",icon:"eva-star-outline","icon-selected":"eva-star",class:"q-my-md",color:"black",readonly:""},null,8,["modelValue"]),i("div",$e,U(o.overview),1)]),i("div",qe,[d(P,{class:"q-pl-none",style:{"border-bottom":"5px solid #000"}},{default:S(()=>[d(O,{class:"text-h3 lilita"},{default:S(()=>[N(" Comments ")]),_:1})]),_:1}),i("div",Ve,[(D(!0),L(j,null,Z(u,l=>(D(),L(j,{key:l.id},[l.comments!==""?(D(),ee(le,te({key:0},l,{onCmtUpdated:t[2]||(t[2]=p=>V(p)),onCmtDeleted:t[3]||(t[3]=p=>R())}),null,16)):se("",!0)],64))),128))])])])])])]))}};export{tt as default};
